%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%                    ATRIBUIÇÃO DE CÓDIGOS À CARACTERES                       %
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\catcode`&=11
\catcode`@=0

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%                    ATRIBUIÇÃO DE PARÂMETROS INTERNOS                        %
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

%%%%%%%%%%%%%%%%%%%%%%%%%%%% ROTINA DE SAÍDA %%%%%%%%%%%%%%%%%%%%%%%%%%%%

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%                               REGISTRADORES                                 %
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\countdef\parte&=12 \parte&=0
\countdef\capitulo&=13 \capitulo&=0
\countdef\secao&=14 \secao&=0
\countdef\subsecao&=15 \subsecao&=0
\countdef\ss&=16 \ss&=0
\countdef\sss&=17 \sss&=0
\countdef\ssss&=18 \ssss&=0
\countdef\sssss&=19 \sssss&=0
\countdef\ssssss&=20 \ssssss&=0
\countdef\sssssss&=21 \sssssss&=0
\countdef\ssssssss&=22 \ssssssss&=0

% Fontes
\font\twentyone&=cmr17 scaled 1200  % Para @**
\font\twenty&=cmr17 scaled 1176     % Para @  e @*0
\font\nineteen&=cmr17 scaled 1118   % Para @*1
\font\eighteen&=cmr17 scaled 1059   % Para @*2
\font\seventeen&=cmr17              % Para @*3
\font\sixteen&=cmr17 scaled 941     % Para @*4
\font\fifteen&=cmr12 scaled 1250   % Para @*5
\font\fourteen&=cmr12 scaled 1167  % Para @*6
\font\thirteen&=cmr12 scaled 1083  % Para @*7
\font\twelve&=cmr12              % Para @*8
\font\eleven&=cmr12 scaled 917     % Para @*9
\font\tenrm&=cmr10                  % Para voltar ao normal.

% Definições
\gdef\naparte&{0} % Estamos formatando o título de uma parte?
\gdef\big&{0}     % Estamos formatando o título de um capítulo ou seção?
\gdef\c&{0}       % Estamos formatando código C?
{\catcode`.=13\gdef.{\if\naparte&1\vskip5mm\else\if\big&1\vskip5mm\else
        \vskip3mm\fi\fi\tenrm&
        \catcode`.=12\par\alinhanormal\if\naparte&1\vfill\quebra\fi
        \gdef\naparte&{0}\gdef\big&{0}}}
\def@*#1{\catcode`.=13\fimcodigo&
        \if#1*\quebra\ \vfill\rightskip 0em plus 1fil \leftskip 0em plus 2fil
              \twentyone&\advance\parte& by 1  % @**
              \gdef\naparte&{1}\noindent Parte \the\parte&:\else
        \if#10\vfil\quebra\twenty&\vskip5mm\advance\capitulo& by 1 % @*0
             \vfill\rightskip 0em plus 1fil \leftskip 0em plus 2fil
             \gdef\big&{1}\noindent Capítulo \the\capitulo&:\else
         \if#11\nineteen&\vskip5mm\advance\secao& by 1 % @*1
              \gdef\big&{1}\noindent\the\capitulo&.\the\secao&\ - \else
         \if#12\eighteen&\vskip3mm\advance\subsecao& by 1 % @*2
               \noindent\the\capitulo&.\the\secao&.\the\subsecao&-\else
         \if#13\seventeen&\vskip3mm\advance\ss& by 1 % @*3
               \noindent\the\capitulo&.\the\secao&.\the\subsecao&.\the\ss&-\else
         \if#14\sixteen&\vskip3mm\advance\sss& by 1 % @*4
               \noindent\the\capitulo&.\the\secao&.\the\subsecao&.\the\ss&.%
               \the\sss&-\else
         \if#15\fifteen&\vskip3mm\advance\ssss& by 1 % @*5
               \noindent\the\capitulo&.\the\secao&.\the\subsecao&.\the\ss&.%
               \the\sss&.\the\ssss&-\else
         \if#16\fourteen&\vskip3mm\advance\sssss& by 1 % @*6
               \noindent\the\capitulo&.\the\secao&.\the\subsecao&.\the\ss&.%
               \the\sss&.\the\ssss&.\the\sssss&-\else
         \if#17\thirteen&\vskip3mm\advance\ssssss& by 1 % @*6
               \noindent\the\capitulo&.\the\secao&.\the\subsecao&.\the\ss&.%
               \the\sss&.\the\ssss&.\the\sssss&.\the\ssssss&-\else
         \if#18\twelve&\vskip3mm\advance\sssssss& by 1 % @*6
               \noindent\the\capitulo&.\the\secao&.\the\subsecao&.\the\ss&.%
               \the\sss&.\the\ssss&.\the\sssss&.\the\ssssss&.\the\sssssss&-\else
         \if#19\eleven&\vskip3mm\advance\ssssssss& by 1 % @*6
               \noindent\the\capitulo&.\the\secao&.\the\subsecao&.\the\ss&.%
               \the\sss&.\the\ssss&.\the\sssss&.\the\ssssss&.\the\sssssss&.%
               \the\ssssssss&-\else

         \vfil\quebra\twenty&\vskip5mm\advance\capitulo& by 1 % @*
         \vfill\rightskip 0em plus 1fil \leftskip 0em plus 2fil
         \noindent Capítulo \the\capitulo&: #1\fi\fi\fi\fi\fi\fi\fi\fi\fi\fi\fi}

% Esta macro é usada em todos os comandos conhecidos por encerrarem
% código C:
\def\fimcodigo&{@fimsh&@if@c&1@catcode`\\=0@alinhanormal@linha@vskip1mm@fi}

\gdef\space&{\hskip 0.5em\sh&}

% Ativa syntax hightlight:
\def\iniciosh&{@everypar{@sh&}%
@gdef@sh&##1{@ifcat##1a@letra&##1@else\expandafter##1@fi}
@gdef@letra&##1{% Invocada quando temos a 1a letra de palavra
  @if##1i%
    @expandafter@expandafter@expandafter@letrai&%
  @else%
    @if##1a%
      @expandafter@expandafter@expandafter@expandafter@expandafter@expandafter@expandafter@letraa&%
    @else%
      @if##1b%
        @expandafter@expandafter@expandafter@expandafter@expandafter@expandafter@expandafter@expandafter@expandafter@expandafter@expandafter@expandafter@expandafter@expandafter@expandafter@letrab&%
      @else%
        @if##1c%
          @expandafter@expandafter@expandafter@expandafter@expandafter@expandafter@expandafter@expandafter@expandafter@expandafter@expandafter@expandafter@expandafter@expandafter@expandafter@expandafter@expandafter@expandafter@expandafter@expandafter@expandafter@expandafter@expandafter@expandafter@expandafter@expandafter@expandafter@expandafter@expandafter@expandafter@expandafter@letrac&%
        @else%
          ##1%
        @fi%
      @fi%
    @fi%
  @fi}%
@gdef@letrac&##1{% Temos a letra 'c'
  @ifcat##1a%
    @letraC&##1%
  @else%
    c@expandafter##1%    
  @fi%
}%
@gdef@letraC&##1{% Temos a letra 'c'+letra
  @if##1a%
    @expandafter@expandafter@expandafter@letraca&%
  @else%
    @if##1h%
      @expandafter@expandafter@expandafter@expandafter@expandafter@expandafter@expandafter@letrach&%
    @else%
      @if##1o%
        @expandafter@expandafter@expandafter@expandafter@expandafter@expandafter@expandafter@expandafter@expandafter@expandafter@expandafter@expandafter@expandafter@expandafter@expandafter@letraco&
      @else%
        c##1%
      @fi
    @fi%
  @fi%
}%
@gdef@letraco&##1{% Temos 'co'
  @ifcat##1a%
    @letraCO&##1%
  @else%
    co@expandafter##1%    
  @fi%
}%
@gdef@letraCO&##1{% Temos 'co'+letra
  @if##1n%
    @expandafter@expandafter@expandafter@letracon&%
  @else%
    co##1%
  @fi%
}%
@gdef@letracon&##1{% Temos 'con'
  @ifcat##1a%
    @letraCON&##1%
  @else%
    con@expandafter##1%    
  @fi%
}%
@gdef@letraCON&##1{% Temos 'con'+letra
  @if##1s%
    @expandafter@expandafter@expandafter@letracons&%
  @else%
    @if##1t%
      @expandafter@expandafter@expandafter@expandafter@expandafter@expandafter@expandafter@letracont&%
    @else%
      con##1%
    @fi%
  @fi%
}%
@gdef@letracons&##1{% Temos 'cons'
  @ifcat##1a%
    @letraCONS&##1%
  @else%
    cons@expandafter##1%    
  @fi%
}%
@gdef@letraCONS&##1{% Temos 'cons'+letra
  @if##1t%
    @expandafter@expandafter@expandafter@letraconst&%
  @else%
    cons##1%
  @fi%
}%
@gdef@letracont&##1{% Temos 'cont'
  @ifcat##1a%
    @letraCONT&##1%
  @else%
    cont@expandafter##1%    
  @fi%
}%
@gdef@letraCONT&##1{% Temos 'cont'+letra
  @if##1i%
    @expandafter@expandafter@expandafter@letraconti&%
  @else%
    cont##1%
  @fi%
}%
@gdef@letraconti&##1{% Temos 'conti'
  @ifcat##1a%
    @letraCONTI&##1%
  @else%
    conti@expandafter##1%    
  @fi%
}%
@gdef@letraCONTI&##1{% Temos 'conti'+letra
  @if##1n%
    @expandafter@expandafter@expandafter@letracontin&%
  @else%
    conti##1%
  @fi%
}%
@gdef@letracontin&##1{% Temos 'contin'
  @ifcat##1a%
    @letraCONTIN&##1%
  @else%
    contin@expandafter##1%    
  @fi%
}%
@gdef@letraCONTIN&##1{% Temos 'contin'+letra
  @if##1u%
    @expandafter@expandafter@expandafter@letracontinu&%
  @else%
    contin##1%
  @fi%
}%
@gdef@letracontinu&##1{% Temos 'continu'
  @ifcat##1a%
    @letraCONTINU&##1%
  @else%
    continu@expandafter##1%    
  @fi%
}%
@gdef@letraCONTINU&##1{% Temos 'continu'+letra
  @if##1e%
    @expandafter@expandafter@expandafter@letracontinue&%
  @else%
    continu##1%
  @fi%
}%
@gdef@letracontinue&##1{% Temos 'continue'
  @ifcat##1a%
    continue##1%
  @else%
    @cor{0 0.5 0.5}{continue}@expandafter##1%    
  @fi%
}%
@gdef@letraconst&##1{% Temos 'const'
  @ifcat##1a%
    const##1%
  @else%
    @cor{0 0.5 0.5}{const}@expandafter##1%    
  @fi%
}%
@gdef@letrach&##1{% Temos 'ch'
  @ifcat##1a%
    @letraCH&##1%
  @else%
    ch@expandafter##1%    
  @fi%
}%
@gdef@letraCH&##1{% Temos 'ch'+letra
  @if##1a%
    @expandafter@expandafter@expandafter@letracha&%
  @else%
    ch##1%
  @fi%
}%
@gdef@letracha&##1{% Temos 'cha'
  @ifcat##1a%
    @letraCHA&##1%
  @else%
    cha@expandafter##1%    
  @fi%
}%
@gdef@letraCHA&##1{% Temos 'cha'+letra
  @if##1r%
    @expandafter@expandafter@expandafter@letrachar&%
  @else%
    cha##1%
  @fi%
}%
@gdef@letrachar&##1{% Temos 'char'
  @ifcat##1a%
    char##1%
  @else%
    @cor{0 0.5 0}{char}@expandafter##1%
  @fi%
}%
@gdef@letraca&##1{% Temos a letra 'ca'
  @ifcat##1a%
    @letraCA&##1%
  @else%
    ca@expandafter##1%    
  @fi%
}%
@gdef@letraCA&##1{% Temos a letra 'ca'+letra
  @if##1s%
    @expandafter@expandafter@expandafter@letracas&%
  @else%
    ca##1%
  @fi%
}%
@gdef@letracas&##1{% Temos 'cas'
  @ifcat##1a%
    @letraCAS&##1%
  @else%
    cas@expandafter##1%    
  @fi%
}%
@gdef@letraCAS&##1{% Temos a letra 'cas'+letra
  @if##1e%
    @expandafter@expandafter@expandafter@letracase&%
  @else%
    cas##1%
  @fi%
}%
@gdef@letracase&##1{% Temos 'case'
  @ifcat##1a%
    case##1%
  @else%
    @cor{0 0.5 0.5}{case}@expandafter##1%
  @fi%
}%
@gdef@letrab&##1{% Temos a letra 'b'
  @ifcat##1a%
    @letraB&##1%
  @else%
    b@expandafter##1%    
  @fi%
}%
@gdef@letraB&##1{% Temos a letra 'b'+letra
  @if##1r%
    @expandafter@expandafter@expandafter@letrabr&%
  @else%
    @if##1o%
      @expandafter@expandafter@expandafter@expandafter@expandafter@expandafter@expandafter@letrabo&%
    @else%
      b##1%
    @fi%    
  @fi%
}%
@gdef@letrabo&##1{% Temos 'bo'
  @ifcat##1a%
    @letraBO&##1%
  @else%
    bo@expandafter##1%    
  @fi%
}%
@gdef@letraBO&##1{% Temos 'bo'+letra
  @if##1o%
    @expandafter@expandafter@expandafter@letraboo&%
  @else%
    bo##1%
  @fi%
}%
@gdef@letraboo&##1{% Temos 'boo'
  @ifcat##1a%
    @letraBOO&##1%
  @else%
    boo@expandafter##1%    
  @fi%
}%
@gdef@letraBOO&##1{% Temos 'boo'+letra
  @if##1l%
    @expandafter@expandafter@expandafter@letrabool&%
  @else%
    boo##1%
  @fi%
}%
@gdef@letrabool&##1{% Temos 'bool'
  @ifcat##1a%
    bool##1%
  @else%
    @cor{0 0.5 0}{bool}@expandafter##1%
  @fi%
}%
@gdef@letrabr&##1{% Temos 'br'
  @ifcat##1a%
    @letraBR&##1%
  @else%
    br@expandafter##1%    
  @fi%
}%
@gdef@letraBR&##1{% Temos 'br'+letra
  @if##1e%
    @expandafter@expandafter@expandafter@letrabre&%
  @else%
    br##1%
  @fi%
}%
@gdef@letrabre&##1{% Temos 'bre'
  @ifcat##1a%
    @letraBRE&##1%
  @else%
    bre@expandafter##1%    
  @fi%
}%
@gdef@letraBRE&##1{% Temos 'bre'+letra
  @if##1a%
    @expandafter@expandafter@expandafter@letrabrea&%
  @else%
    bre##1%
  @fi%
}%
@gdef@letrabrea&##1{% Temos 'brea'
  @ifcat##1a%
    @letraBREA&##1%
  @else%
    brea@expandafter##1%    
  @fi%
}%
@gdef@letraBREA&##1{% Temos 'brea'+letra
  @if##1k%
    @expandafter@expandafter@expandafter@letrabreak&%
  @else%
    brea##1%
  @fi%
}%
@gdef@letrabreak&##1{% Temos 'break'
  @ifcat##1a%
    break##1%
  @else%
    @cor{0 0.5 0.5}{break}@expandafter##1%    
  @fi%
}%
@gdef@letraa&##1{% Temos a letra 'a'
  @ifcat##1a%
    @letraA&##1%
  @else%
    a@expandafter##1%    
  @fi%
}%
@gdef@letraA&##1{% Temos a letra 'a'+letra
  @if##1u%
    @expandafter@expandafter@expandafter@letraau&%
  @else%
    a##1%
  @fi%
}%
@gdef@letraau&##1{% Temos 'au'
  @ifcat##1a%
    @letraAU&##1%
  @else%
    au@expandafter##1%    
  @fi%
}%
@gdef@letraAU&##1{% Temos 'au'+letra
  @if##1t%
    @expandafter@expandafter@expandafter@letraaut&%
  @else%
    au##1%
  @fi%
}%
@gdef@letraaut&##1{% Temos 'aut'
  @ifcat##1a%
    @letraAUT&##1%
  @else%
    aut@expandafter##1%
  @fi%
}%
@gdef@letraAUT&##1{% Temos 'aut+letra'
  @if##1o%
    @expandafter@expandafter@expandafter@letraauto&%
  @else%
    aut##1%
  @fi%
}%
@gdef@letraauto&##1{% Temos 'auto'
  @ifcat##1a%
    auto##1%
  @else%
    @cor{0 0.5 0.5}{auto}@expandafter##1%
  @fi%
}%
@gdef@letrai&##1{% Invocada quando a 1a letra é i
  @ifcat##1a%
    @letraI&##1%
  @else%
    i@expandafter##1%
  @fi}%
@gdef@letraI&##1{% Invocada quando a 1a letra é i+letra
  @if##1f%
    @expandafter@expandafter@expandafter@letraif&%
  @else%
    @if##1n%
      @expandafter@expandafter@expandafter@expandafter@expandafter@expandafter@expandafter@letrain&%
    @else%
      i##1%
    @fi%
  @fi%
}%
@gdef@letraif&##1{% Lemos um 'if' e checamos se palavra terminou
  @ifcat##1a%
    if##1%
  @else%
    @cor{0 0.5 0.5}{if}@expandafter##1%
  @fi}%
@gdef@letrain&##1{% Lemos um 'in'
  @ifcat##1a%
    @letraIN&##1%
  @else%
    in@expandafter##1%
  @fi}%
@gdef@letraIN&##1{% Lemos um 'in'+letra
  @if##1t%
    @expandafter@expandafter@expandafter@letraint&%
  @else%
    in##1%
  @fi%
}%
@gdef@letraint&##1{% Lemos um 'int'
  @ifcat##1a%
    int##1%
  @else%
    @cor{0 0.5 0}{int}@expandafter##1%
  @fi}%
}
\def\fimsh&{@gdef@sh&{}@everypar{}}

% O @ agora precisa ser usado como comando
\def@@{\char"40}

% Um espaço agora pode terminar a região de código C:
\def\space&{ } 
\def@ {\fimcodigo&\space&}

% A região de código C funcionará de modo semelhante ao modo
% verbatim. A diferença é que o '\' passará a ser considerado
% caractere comum. Desta forma, comandos só poderão ser digitados com
% o '@.
\def\alinhacodigo{\linha\alinhaverbatim\gdef\c&{1}\catcode`\\=12@iniciosh&}


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%                              CÓDIGO INICIAL                                 %
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\catcode`&=4 % @ não será mais usado em nomes de sequencias de controle
